var isLoading=0,FromObject="0",Items=null,lastClickedObj=0,clickedFolderBarCode=new Array;function popupWindow(e,t){disableCheckChangedStatus(),winW_H(),$(e).style.width=winW+"px",$(e).style.height=winH+"px",$(e).style.visibility="visible",$("popupframe").src=t}function hidePop(e){"apply"!=e&&enableCheckChangedStatus(),setTimeout((function(){document.getElementById("popupframe").src=""}),100),$("OverlayMask").style.visibility="hidden"}function GetFolderItem(e,t){var i,s;showClickedObj(e),0==(s=get_layer(i=e.id.substring(1)))?alert("Machine: Wrong"):1==s?(setSelectedDisk(e),onEvent()):2==s?(setSelectedPool(e),onEvent()):3==s&&(setSelectedFolder(e),onEvent(),showApplyBtn()),t&&GetTree(i,1)}function getSelectedStatusOfPool(e){for(var t="",i=0;i<pool_names().length;++i)if(pool_names()[i]==e){t=pool_status()[i];break}return t}function showClickedObj(e){0!=this.lastClickedObj&&(this.lastClickedObj.className="lastfolderClicked"),e.className="folderClicked",this.lastClickedObj=e}function GetTree(e,t){if("0"==e)return this.FromObject=e,$("d"+e).innerHTML='<span class="FdWait">. . . . . . . . . .</span>',void setTimeout('get_layer_items("'+e+'", "gettree")',1);"FdRead"==$("a"+e).className?($("a"+e).className="FdOpen",$("a"+e).src="/images/Tree/vert_line_s"+t+"1.gif",this.FromObject=e,$("e"+e).innerHTML='<img src="/images/Tree/folder_wait.gif">',setTimeout('get_layer_items("'+e+'", "gettree")',1)):"FdOpen"==$("a"+e).className?($("a"+e).className="FdClose",$("a"+e).src="/images/Tree/vert_line_s"+t+"0.gif",$("e"+e).style.position="absolute",$("e"+e).style.visibility="hidden"):"FdClose"==$("a"+e).className?($("a"+e).className="FdOpen",$("a"+e).src="/images/Tree/vert_line_s"+t+"1.gif",$("e"+e).style.position="",$("e"+e).style.visibility=""):alert("Error when show the folder-tree!")}function get_disk_tree(){0==this.isLoading&&(get_layer_items("0","gettree"),setTimeout("get_disk_tree();",1e3))}function get_layer_items(e,t){disableCheckChangedStatus(),document.aidiskForm.action="/aidisk/getsharearray.asp",$("motion").value=t,$("layer_order").value=e,document.aidiskForm.submit_fake.click()}function get_tree_items(e,t){this.isLoading=1,this.Items=e,"lookup"==t||"gettree"==t&&this.Items&&this.Items.length>0&&BuildTree()}function BuildTree(){for(var e,t,i,s,n,l,a="<table cellpadding=0 cellspacing=0 border=0>\n",o=0;o<this.Items.length;++o){this.Items[o]=this.Items[o].split("#");var c;if((c=this.Items[o].length)>3){var r=new Array(3);r[2]=this.Items[o][c-1],r[1]=this.Items[o][c-2],r[0]="";for(var d=0;d<c-2;++d)0!=d&&(r[0]+="#"),r[0]+=this.Items[o][d];this.Items[o]=r}e=this.Items[o][0].replace(/^[\s]+/gi,"").replace(/[\s]+$/gi,""),t=this.FromObject+"_"+this.Items[o][1].replace(/^[\s]+/gi,"").replace(/[\s]+$/gi,""),i=parseInt(this.Items[o][2].replace(/^[\s]+/gi,"").replace(/[\s]+$/gi,"")),s=1==(l=get_layer(t.substring(1)))?"9":2==l?"4":"10",SubClick=' onclick="GetFolderItem(this, ',i<=0?(SubClick+='0);"',n="n"):(SubClick+='1);"',n="s"),o==this.Items.length-1?("",n+="1"):(' background="/images/Tree/vert_line.gif"',n+="0"),a+='<tr>\n<td width=19 height=16 valign=top>\n<img id="a'+t+'" onclick=\'$("d'+t+'").onclick();\' class="FdRead" src="/images/Tree/vert_line_'+n+'0.gif">\n</td>\n<td>\n';var h="",g="";3==l?(h=e.length>19?e.substring(0,16)+"...":e,g=showhtmlspace(h),a+='<div id="b'+t+'" style="float:left; width:170px; overflow:hidden;" class="FdText">\n<img id="c'+t+'" onclick=\'$("d'+t+'").onclick();\' src="/bootstrap/img/wl_device/'+s+'.gif" align=top>\n<span id="d'+t+'"'+SubClick+' title="'+e+'">'+g+"</span>\n</div>\n",a+='<div id="f'+t+'" class="FileStatus" style="margin-left: 10px;" onclick="getChangedPermission(this);"></div>\n\n'):(g=showhtmlspace(e),a+='<div id="b'+t+'" class="FdText">\n<img id="c'+t+'" onclick=\'$("d'+t+'").onclick();\' src="/bootstrap/img/wl_device/'+s+'.gif" align=top>\n<span id="d'+t+'"'+SubClick+' title="'+e+'">'+g+"</span>\n</div>\n",a+='<div id="e'+t+'" class="FdTemp"></div>\n'),a+="</td>\n</tr>\n"}if(a+="</table>\n",$("e"+this.FromObject).innerHTML=a,3==l)for(o=0;o<this.Items.length;++o)e=this.Items[o][0].replace(/^[\s]+/gi,"").replace(/[\s]+$/gi,""),t=this.FromObject+"_"+this.Items[o][1].replace(/^[\s]+/gi,"").replace(/[\s]+$/gi,""),add_folderBarCode_list(this.selectedPool,e,t),showPermissionRadio(t,this.selectedAccount.length>0?get_permission_of_folder(this.selectedAccount,this.selectedPool,e,PROTOCOL):3)}function showPermissionRadio(e,t){var i="",s=e.substring(0,e.lastIndexOf("_")),n=getSelectedStatusOfPool($("d"+s).firstChild.nodeValue);i+='<input type="radio" style="margin-top: 0px; margin-left: '+("cifs"==PROTOCOL?20:15)+'px" name="g'+e+'" value="3"',(3==t||"cifs"==PROTOCOL&&2==t)&&(i+=" checked"),(this.selectedAccount.length<=0||"anonymous"==this.selectedAccount&&"cifs"!=PROTOCOL||"rw"!=n)&&(i+=" disabled"),i+=">","ftp"==PROTOCOL?(i+='<input type="radio" style="margin-top: 0px; margin-left: 30px" name="g'+e+'" value="2"',2==t&&(i+=" checked"),(this.selectedAccount.length<=0||"anonymous"==this.selectedAccount||"rw"!=n)&&(i+=" disabled"),i+=">"):"cifs"==PROTOCOL&&(i+="<span></span>\n"),i+='<input type="radio" style="margin-top: 0px; margin-left: '+("cifs"==PROTOCOL?40:30)+'px" name="g'+e+'" value="1"',1==t&&(i+=" checked"),(this.selectedAccount.length<=0||"rw"!=n)&&(i+=" disabled"),i+=">","cifs"==PROTOCOL&&(i+="<span></span>\n"),i+='<input type="radio" style="margin-top: 0px; margin-left: '+("cifs"==PROTOCOL?40:30)+'px" name="g'+e+'" value="0"',0==t&&(i+=" checked"),(this.selectedAccount.length<=0||"rw"!=n)&&(i+=" disabled"),i+=">",$("f"+e).innerHTML=i}function getChangedPermission(e){var t,i=e.id.substring(1),s=$("d"+i),n="g"+i;this.selectedAccount&&(setSelectedFolder(s),-1!=(t=getValueofRadio(n))?(this.changedPermissions[this.selectedAccount]||(this.changedPermissions[this.selectedAccount]=new Array),this.changedPermissions[this.selectedAccount][this.selectedPool]||(this.changedPermissions[this.selectedAccount][this.selectedPool]=new Array),this.changedPermissions[this.selectedAccount][this.selectedPool][this.selectedFolder]=t,0!=this.controlApplyBtn&&1!=this.controlApplyBtn||(this.controlApplyBtn+=2),showApplyBtn(),onEvent()):alert("Can't read the permission when change the radio!"))}function getValueofRadio(e){for(var t=getElementsByName_iefix("input",e),i=0;i<t.length;++i)if(1==t[i].checked)return t[i].value;return-1}function get_layer(e){var t;for(t=0;-1!=e.indexOf("_");)++t,e=(e=e.substring(e.indexOf("_"),e.length)).substring(1);return t}function add_folderBarCode_list(e,t,i){this.clickedFolderBarCode[e]||(this.clickedFolderBarCode[e]=new Array),this.clickedFolderBarCode[e][t]=i}function get_folderBarCode_in_pool(e,t){return this.clickedFolderBarCode[e]&&this.clickedFolderBarCode[e][t]?this.clickedFolderBarCode[e][t]:""}